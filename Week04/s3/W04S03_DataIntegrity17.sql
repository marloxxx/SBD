/*
	Nama	: Horas Marolop Amsal Siregar
	NIM		: 11321051
	Kelas	: 32TI2
    Nama    : Theofil Nainggolan
    NIM     : 11321052
    Kelas   : 32TI2
    Nama    : Yohana Tambunan
    NIM     : 11321053
    Kelas   : 32TI2
*/

-- 1. Buatlah sebuah file database dengan mengikuti diagram yang diberikan, dengan nama
-- PRESDB. Terdiri atas 7 buah tabel yaitu Election, Administration, Pres Hobby,
-- President, Pres Marriage, Admin PR VP dan State. Dengan masing-masing atribut
-- yang terlihat pada diagram berikut ini.
CREATE DATABASE PRESDB
GO

USE PRESDB
GO

CREATE TABLE PRESIDENT
(
PRES_NAME CHAR(16) NOT NULL,
BIRTH_YR SMALLINT NOT NULL,
YRS_SERV SMALLINT NOT NULL,
DEATH_AGE SMALLINT NULL,
PARTY CHAR(11) NOT NULL,
STATE_BORN CHAR(15) NULL
)

CREATE TABLE PRES_MARRIAGE
(
PRES_NAME CHAR(16) NOT NULL,
SPOUSE_NAME CHAR(16) NOT NULL,
PR_AGE SMALLINT NOT NULL,
SP_AGE SMALLINT NOT NULL,
NR_CHILDREN SMALLINT NOT NULL,
MAR_YEAR SMALLINT NOT NULL
)

CREATE TABLE ADMINISTRATION
(
ADMIN_NR SMALLINT NOT NULL,
PRES_NAME CHAR(16) NOT NULL,
YEAR_INAUGURATED SMALLINT NOT NULL
)

CREATE TABLE PRES_HOBBY
(
PRES_NAME CHAR(16) NOT NULL,
HOBBY CHAR(20) NOT NULL
)

CREATE TABLE STATE
(
STATE_NAME CHAR(15) NOT NULL,
ADMIN_ENTERED SMALLINT NOT NULL,
YEAR_ENTERED SMALLINT NOT NULL
)

CREATE TABLE ADMIN_PR_VP
(
ADMIN_NR SMALLINT NOT NULL,
PRES_NAME CHAR(16) NOT NULL,
VICE_PRES_NAME CHAR(16) NOT NULL
)

CREATE TABLE ELECTION
(
ELECTION_YEAR SMALLINT NOT NULL,
CANDIDATE CHAR(16) NOT NULL,
VOTES SMALLINT NOT NULL,
WINNER_LOSER_INDIC CHAR(1) NOT NULL
)

-- 2. Masukkan minimal 5 dummy data terhadap setiap table yang sudah anda buat dan
-- sesuai dengan ketentuan tipe data masing-masing atribut anda.
INSERT INTO PRESIDENT VALUES ('George', 1732, 8, 67, 'Independent', 'Virginia')
INSERT INTO PRESIDENT VALUES ('John Adams', 1735, 4, 90, 'Federalist', 'Massachusetts')
INSERT INTO PRESIDENT VALUES ('Thomas', 1743, 8, 83, 'Democratic', 'Virginia')
INSERT INTO PRESIDENT VALUES ('James Mad', 1751, 8, 85, 'Democratic', 'Virginia')
INSERT INTO PRESIDENT VALUES ('James Mon', 1758, 8, 73, 'Democratic', 'Virginia')

INSERT INTO PRES_MARRIAGE VALUES ('George', 'Martha Dandridge', 27, 26, 5, 1759)
INSERT INTO PRES_MARRIAGE VALUES ('John Adams', 'Abigail Smith', 61, 57, 6, 1764)
INSERT INTO PRES_MARRIAGE VALUES ('Thomas', 'Martha Wayles', 33, 26, 6, 1772)
INSERT INTO PRES_MARRIAGE VALUES ('James Mad', 'Dolley Payne', 35, 26, 12, 1794)
INSERT INTO PRES_MARRIAGE VALUES ('James Mon', 'Elizabeth', 24, 20, 9, 1782)

INSERT INTO ADMINISTRATION VALUES (1, 'George', 1789)
INSERT INTO ADMINISTRATION VALUES (2, 'John Adams', 1797)
INSERT INTO ADMINISTRATION VALUES (3, 'Thomas', 1801)
INSERT INTO ADMINISTRATION VALUES (4, 'James Mad', 1809)
INSERT INTO ADMINISTRATION VALUES (5, 'James Mon', 1817)

INSERT INTO PRES_HOBBY VALUES ('George', 'Fishing')
INSERT INTO PRES_HOBBY VALUES ('John Adams', 'Reading')
INSERT INTO PRES_HOBBY VALUES ('Thomas', 'Gardening')
INSERT INTO PRES_HOBBY VALUES ('James Mad', 'Hunting')
INSERT INTO PRES_HOBBY VALUES ('James Mon', 'Hunting')

INSERT INTO STATE VALUES ('Virginia', 1, 1788)
INSERT INTO STATE VALUES ('Massachusetts', 2, 1788)
INSERT INTO STATE VALUES ('Los Angles', 3, 1788)
INSERT INTO STATE VALUES ('New York', 4, 1788)
INSERT INTO STATE VALUES ('New Jersey', 5, 1788)

INSERT INTO ADMIN_PR_VP VALUES (1, 'George', 'John Adams')
INSERT INTO ADMIN_PR_VP VALUES (2, 'John Adams', 'Thomas')
INSERT INTO ADMIN_PR_VP VALUES (3, 'Thomas', 'Aaron Burr')
INSERT INTO ADMIN_PR_VP VALUES (4, 'James Mad', 'George Clinton')
INSERT INTO ADMIN_PR_VP VALUES (5, 'James Mon', 'Daniel D.')

INSERT INTO ELECTION VALUES (1788, 'George', 69, 'W')
INSERT INTO ELECTION VALUES (1792, 'John Adams', 34, 'W')
INSERT INTO ELECTION VALUES (1796, 'Thomas', 73, 'W')
INSERT INTO ELECTION VALUES (1800, 'Thomas', 68, 'W')
INSERT INTO ELECTION VALUES (1804, 'James Mad', 122, 'W')

-- 3. Implementasikan lah masing-masing constraint berikut ini ke dalam PRESDB:
-- a)Default
ALTER TABLE PRESIDENT ADD CONSTRAINT PRESIDENT_DK DEFAULT 'Virginia' FOR STATE_BORN
ALTER TABLE PRES_MARRIAGE ADD CONSTRAINT PRES_MARRIAGE_DK DEFAULT 0 FOR PR_AGE
ALTER TABLE ADMINISTRATION ADD CONSTRAINT ADMINISTRATION_DK DEFAULT 0 FOR YEAR_INAUGURATED
ALTER TABLE PRES_HOBBY ADD CONSTRAINT PRES_HOBBY_DK DEFAULT 'Fishing' FOR HOBBY
ALTER TABLE STATE ADD CONSTRAINT STATE_DK DEFAULT 0 FOR ADMIN_ENTERED
ALTER TABLE ADMIN_PR_VP ADD CONSTRAINT ADMIN_PR_VP_DK DEFAULT 'John Adams' FOR VICE_PRES_NAME
ALTER TABLE ELECTION ADD CONSTRAINT ELECTION_DK DEFAULT 0 FOR VOTES

-- b)Check
ALTER TABLE PRESIDENT ADD CONSTRAINT PRESIDENT_CK CHECK (BIRTH_YR > 1700 AND BIRTH_YR < 1800)
ALTER TABLE PRES_MARRIAGE ADD CONSTRAINT PRES_MARRIAGE_CK CHECK (PR_AGE > 18 AND PR_AGE < 100)
ALTER TABLE ADMINISTRATION ADD CONSTRAINT ADMINISTRATION_CK CHECK (YEAR_INAUGURATED > 1788 AND YEAR_INAUGURATED < 1820)
ALTER TABLE PRES_HOBBY ADD CONSTRAINT PRES_HOBBY_CK CHECK (HOBBY = 'Fishing' OR HOBBY = 'Reading' OR HOBBY = 'Gardening' OR HOBBY = 'Hunting')
ALTER TABLE STATE ADD CONSTRAINT STATE_CK CHECK (YEAR_ENTERED >= 1788 AND YEAR_ENTERED <= 1820)
ALTER TABLE ADMIN_PR_VP ADD CONSTRAINT ADMIN_PR_VP_CK CHECK (VICE_PRES_NAME = 'John Adams' OR VICE_PRES_NAME = 'Thomas' OR VICE_PRES_NAME = 'Aaron Burr' OR VICE_PRES_NAME = 'George Clinton' OR VICE_PRES_NAME = 'Daniel D.')
ALTER TABLE ELECTION ADD CONSTRAINT ELECTION_CK CHECK (WINNER_LOSER_INDIC = 'W' OR WINNER_LOSER_INDIC = 'L')

-- c)Primary Key
ALTER TABLE PRESIDENT ADD CONSTRAINT PRESIDENT_PK PRIMARY KEY (PRES_NAME)
ALTER TABLE PRES_MARRIAGE ADD CONSTRAINT PRES_MARRIAGE_PK PRIMARY KEY (PRES_NAME, SPOUSE_NAME)
ALTER TABLE ADMINISTRATION ADD CONSTRAINT ADMINISTRATION_PK PRIMARY KEY (ADMIN_NR)
ALTER TABLE PRES_HOBBY ADD CONSTRAINT PRES_HOBBY_PK PRIMARY KEY (PRES_NAME, HOBBY)
ALTER TABLE STATE ADD CONSTRAINT STATE_PK PRIMARY KEY (STATE_NAME)
ALTER TABLE ADMIN_PR_VP ADD CONSTRAINT ADMIN_PR_VP_PK PRIMARY KEY (ADMIN_NR, PRES_NAME, VICE_PRES_NAME)
ALTER TABLE ELECTION ADD CONSTRAINT ELECTION_PK PRIMARY KEY (ELECTION_YEAR, CANDIDATE)

-- d)Unique Key
ALTER TABLE PRESIDENT ADD CONSTRAINT PRESIDENT_UK UNIQUE (BIRTH_YR)
ALTER TABLE PRES_MARRIAGE ADD CONSTRAINT PRES_MARRIAGE_UK UNIQUE (PR_AGE)
ALTER TABLE ADMINISTRATION ADD CONSTRAINT ADMINISTRATION_UK UNIQUE (YEAR_INAUGURATED)
ALTER TABLE PRES_HOBBY ADD CONSTRAINT PRES_HOBBY_UK UNIQUE (PRES_NAME)
ALTER TABLE STATE ADD CONSTRAINT STATE_UK UNIQUE (STATE_NAME)
ALTER TABLE ADMIN_PR_VP ADD CONSTRAINT ADMIN_PR_VP_UK UNIQUE (VICE_PRES_NAME)
ALTER TABLE ELECTION ADD CONSTRAINT ELECTION_UK UNIQUE (VOTES)

-- e)Foreign Key
ALTER TABLE PRESIDENT ADD CONSTRAINT PRESIDENT_FK FOREIGN KEY (STATE_BORN) REFERENCES STATE(STATE_NAME)
ALTER TABLE PRES_MARRIAGE ADD CONSTRAINT PRES_MARRIAGE_FK FOREIGN KEY (PRES_NAME) REFERENCES PRESIDENT(PRES_NAME)
ALTER TABLE PRES_HOBBY ADD CONSTRAINT PRES_HOBBY_FK FOREIGN KEY (PRES_NAME) REFERENCES PRESIDENT(PRES_NAME)
ALTER TABLE ADMIN_PR_VP ADD CONSTRAINT ADMIN_PR_VP_FK FOREIGN KEY (ADMIN_NR) REFERENCES ADMINISTRATION(ADMIN_NR)
ALTER TABLE ADMINISTRATION ADD CONSTRAINT ADMINISTRATION_FK FOREIGN KEY (PRES_NAME) REFERENCES PRESIDENT(PRES_NAME)

-- f) Cascade Referential Integrity
ALTER TABLE PRESIDENT ADD CONSTRAINT PRESIDENT_CRI FOREIGN KEY (STATE_BORN) REFERENCES STATE(STATE_NAME) ON DELETE CASCADE
ALTER TABLE PRES_MARRIAGE ADD CONSTRAINT PRES_MARRIAGE_CRI FOREIGN KEY (PRES_NAME) REFERENCES PRESIDENT(PRES_NAME) ON DELETE CASCADE
ALTER TABLE PRES_HOBBY ADD CONSTRAINT PRES_HOBBY_CRI FOREIGN KEY (PRES_NAME) REFERENCES PRESIDENT(PRES_NAME) ON DELETE CASCADE
ALTER TABLE ADMIN_PR_VP ADD CONSTRAINT ADMIN_PR_VP_CRI FOREIGN KEY (ADMIN_NR) REFERENCES ADMINISTRATION(ADMIN_NR) ON DELETE CASCADE
ALTER TABLE ADMINISTRATION ADD CONSTRAINT ADMINISTRATION_CRI FOREIGN KEY (PRES_NAME) REFERENCES PRESIDENT(PRES_NAME) ON DELETE CASCADE